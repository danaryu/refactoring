# 2. 리팩터링 원칙

## 2.1 리팩터링 정의

- 리팩터링: [명사] 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법
  - 함수 추출하기, 조건부 로직을 다형성으로 바꾸기 (1장 참고)
- 리팩터링(하다) : [동사] 소프트웨어의 겉보기 동작은 그대로 유지한 채, 여러 가지 리팩터링 기법을 적용해서 **소프트웨어를 재구성** 하다.
  > 리팩터링은 동작을 보존하는 작은 단계들을 거쳐 코드를 수정하고, 이러한 단계들을 순차적으로 연결하여 큰 변화를 만들어내는 일이다.

## 2.2 두 개의 모자

- 기능 추가
  - 기존 코드는 절대 건드리지 않고 새 기능을 추가하기만 한다.
- 리팩토링
  - 기능 추가는 절대 하지 않고, 코드 재구성에만 전념한다.
  - 인터페이스를 변경해야 할 때를 제외하고는 테스트도 새로 만들지 않는다.

## 2.3 리팩터링 하는 이유

- 리팩터링하면 소프트웨어 설계가 좋아진다.
- 리팩터링하면 소프트웨어를 이해하기 쉬워진다.
- 리팩터링하면 버그를 쉽게 찾을 수 있다.
- 리팩터링하면 프로그래밍 속도를 높일 수 있다. - 내부 설계가 잘 된 소프트웨어는, 새로운 기능을 추가할 지점과 어떻게 고칠지를 쉽게 찾을 수 있다. - 모듈화가 잘 되어 있으면 전체 코드베이스 중 작은 일부만 이해하면 된다. - 코드가 명확하면 버그를 만들 가능성도 줄고, 버그를 만들더라도 디버깅하기가 훨씬 쉽다. - 내부 품질이 뛰어난 코드베이스는 새 기능 구축을 돕는 견고한 토대가 된다.
  > 설계 지구력 가설 : 내부 설계에 심혈을 기울이면 소프트웨어의 지구력이 높아져서 빠르게 개발할 수 있는 상태를 더 오래 지속할 수 있다.

## 2.4 언제 리팩터링해야 할까?

- 3의 법칙 : 스트라이크 세 번이면 리팩터링 하라!

### 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기

- 리팩터링하기 가장 좋은 시점은 코드베이스에 기능을 새로 추가하기 직전이다.
- 구조를 살짝 바꾸면 다른 작업을 하기가 훨씬 쉬워질 만한 부분을 찾는다.

### 이해를 위한 리팩터링 : 코드를 이해하기 쉽게 만들기

- 어떤 역할을 하는지 이해된 변수는 적절한 이름으로 바꿔주고, 긴 함수를 잘게 나눈다.
- 코드를 분석할 때 리팩터링을 해보면, 그렇지 않았더라면 도달하지 못했을 더 깊은 수준까지 이해하게 된다.

### 쓰레기 줍기 리팩터링

- 간단히 수정할 수 있는 것은 즉시 고치고, 시간이 좀 걸리는 일은 짧은 메모만 남긴 다음, 하던 일을 끝내고 나서 처리한다.
- 코드를 훑어볼 때마다 조금씩 개선하다 보면 결국 문제가 해결될 것이다.

### 계획된 리팩터링과 수시로 하는 리팩터링

- 보기싫은 코드를 발견하면 리팩터링하자. 그런데 잘 작성된 코드 역시 수많은 리팩터링을 거쳐야한다.
- 무언가 수정하려 할 때는 먼저 수정하기 쉽게 정돈하고, 그런 다음 쉽게 수정하자.

### 오래 걸리는 리팩터링

- 누구든지 리팩터링해야할 코드와 관련된 작업을 하게 될 때마다 원하는 방향으로 조금씩 개선한다.
- 리팩터링이 코드를 깨트리지 않는다는 장점을 활용한다. -> 일부를 변경해도 모든 기능이 항상 올바르게 동작한다.
  - 예) 라이브러리를 교체할 때는 기존 것과 새 것 모두를 포용하는 추상 인터페이스부터 마련한다. 기존 코드가 이 추상 인터페이스를 호출하도록 만들고 나면 라이브러리를 훨씬 쉽게 교체할 수 있다.

### 리팩터링하지 말아야 할 때

- 지저분한 코드를 발견해도 굳이 수정할 필요가 없다면 리팩터링하지 않는다.
- 리팩터링하는 것보다 처음부터 새로 작성하는 게 쉬울 때도 리팩터링하지 않는다.
